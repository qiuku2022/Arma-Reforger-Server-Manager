import{g as Y,a as Z,b as P,s as K,c as ee,r as te,i as se,u as le,d as ne,e as ae,f as ie,h as re}from"./index-DGO2oQ2b.js";import{d as oe,o as ce,a as ue,c as x,b as s,t as _,n as w,F as fe,r as he,e as de,f as m,g as B,h as C,_ as _e}from"./index-DXihFc6l.js";var E=function(c,e){return Object.defineProperty?Object.defineProperty(c,"raw",{value:e}):c.raw=e,c},o;(function(c){c[c.EOS=0]="EOS",c[c.Text=1]="Text",c[c.Incomplete=2]="Incomplete",c[c.ESC=3]="ESC",c[c.Unknown=4]="Unknown",c[c.SGR=5]="SGR",c[c.OSCURL=6]="OSCURL"})(o||(o={}));class ge{constructor(){this.VERSION="6.0.6",this.setup_palettes(),this._use_classes=!1,this.bold=!1,this.faint=!1,this.italic=!1,this.underline=!1,this.fg=this.bg=null,this._buffer="",this._url_allowlist={http:1,https:1},this._escape_html=!0,this.boldStyle="font-weight:bold",this.faintStyle="opacity:0.7",this.italicStyle="font-style:italic",this.underlineStyle="text-decoration:underline"}set use_classes(e){this._use_classes=e}get use_classes(){return this._use_classes}set url_allowlist(e){this._url_allowlist=e}get url_allowlist(){return this._url_allowlist}set escape_html(e){this._escape_html=e}get escape_html(){return this._escape_html}set boldStyle(e){this._boldStyle=e}get boldStyle(){return this._boldStyle}set faintStyle(e){this._faintStyle=e}get faintStyle(){return this._faintStyle}set italicStyle(e){this._italicStyle=e}get italicStyle(){return this._italicStyle}set underlineStyle(e){this._underlineStyle=e}get underlineStyle(){return this._underlineStyle}setup_palettes(){this.ansi_colors=[[{rgb:[0,0,0],class_name:"ansi-black"},{rgb:[187,0,0],class_name:"ansi-red"},{rgb:[0,187,0],class_name:"ansi-green"},{rgb:[187,187,0],class_name:"ansi-yellow"},{rgb:[0,0,187],class_name:"ansi-blue"},{rgb:[187,0,187],class_name:"ansi-magenta"},{rgb:[0,187,187],class_name:"ansi-cyan"},{rgb:[255,255,255],class_name:"ansi-white"}],[{rgb:[85,85,85],class_name:"ansi-bright-black"},{rgb:[255,85,85],class_name:"ansi-bright-red"},{rgb:[0,255,0],class_name:"ansi-bright-green"},{rgb:[255,255,85],class_name:"ansi-bright-yellow"},{rgb:[85,85,255],class_name:"ansi-bright-blue"},{rgb:[255,85,255],class_name:"ansi-bright-magenta"},{rgb:[85,255,255],class_name:"ansi-bright-cyan"},{rgb:[255,255,255],class_name:"ansi-bright-white"}]],this.palette_256=[],this.ansi_colors.forEach(l=>{l.forEach(t=>{this.palette_256.push(t)})});let e=[0,95,135,175,215,255];for(let l=0;l<6;++l)for(let t=0;t<6;++t)for(let u=0;u<6;++u){let i={rgb:[e[l],e[t],e[u]],class_name:"truecolor"};this.palette_256.push(i)}let n=8;for(let l=0;l<24;++l,n+=10){let t={rgb:[n,n,n],class_name:"truecolor"};this.palette_256.push(t)}}escape_txt_for_html(e){return this._escape_html?e.replace(/[&<>"']/gm,n=>{if(n==="&")return"&amp;";if(n==="<")return"&lt;";if(n===">")return"&gt;";if(n==='"')return"&quot;";if(n==="'")return"&#x27;"}):e}append_buffer(e){var n=this._buffer+e;this._buffer=n}get_next_packet(){var e={kind:o.EOS,text:"",url:""},n=this._buffer.length;if(n==0)return e;var l=this._buffer.indexOf("\x1B");if(l==-1)return e.kind=o.Text,e.text=this._buffer,this._buffer="",e;if(l>0)return e.kind=o.Text,e.text=this._buffer.slice(0,l),this._buffer=this._buffer.slice(l),e;if(l==0){if(n<3)return e.kind=o.Incomplete,e;var t=this._buffer.charAt(1);if(t!="["&&t!="]"&&t!="(")return e.kind=o.ESC,e.text=this._buffer.slice(0,1),this._buffer=this._buffer.slice(1),e;if(t=="["){this._csi_regex||(this._csi_regex=U(D||(D=E([`
                        ^                           # beginning of line
                                                    #
                                                    # First attempt
                        (?:                         # legal sequence
                          \x1B[                      # CSI
                          ([<-?]?)              # private-mode char
                          ([d;]*)                    # any digits or semicolons
                          ([ -/]?               # an intermediate modifier
                          [@-~])                # the command
                        )
                        |                           # alternate (second attempt)
                        (?:                         # illegal sequence
                          \x1B[                      # CSI
                          [ -~]*                # anything legal
                          ([\0-:])              # anything illegal
                        )
                    `],[`
                        ^                           # beginning of line
                                                    #
                                                    # First attempt
                        (?:                         # legal sequence
                          \\x1b\\[                      # CSI
                          ([\\x3c-\\x3f]?)              # private-mode char
                          ([\\d;]*)                    # any digits or semicolons
                          ([\\x20-\\x2f]?               # an intermediate modifier
                          [\\x40-\\x7e])                # the command
                        )
                        |                           # alternate (second attempt)
                        (?:                         # illegal sequence
                          \\x1b\\[                      # CSI
                          [\\x20-\\x7e]*                # anything legal
                          ([\\x00-\\x1f:])              # anything illegal
                        )
                    `]))));let i=this._buffer.match(this._csi_regex);if(i===null)return e.kind=o.Incomplete,e;if(i[4])return e.kind=o.ESC,e.text=this._buffer.slice(0,1),this._buffer=this._buffer.slice(1),e;i[1]!=""||i[3]!="m"?e.kind=o.Unknown:e.kind=o.SGR,e.text=i[2];var u=i[0].length;return this._buffer=this._buffer.slice(u),e}else if(t=="]"){if(n<4)return e.kind=o.Incomplete,e;if(this._buffer.charAt(2)!="8"||this._buffer.charAt(3)!=";")return e.kind=o.ESC,e.text=this._buffer.slice(0,1),this._buffer=this._buffer.slice(1),e;this._osc_st||(this._osc_st=be(M||(M=E([`
                        (?:                         # legal sequence
                          (\x1B\\)                    # ESC                           |                           # alternate
                          (\x07)                      # BEL (what xterm did)
                        )
                        |                           # alternate (second attempt)
                        (                           # illegal sequence
                          [\0-]                 # anything illegal
                          |                           # alternate
                          [\b-]                 # anything illegal
                          |                           # alternate
                          [-]                 # anything illegal
                        )
                    `],[`
                        (?:                         # legal sequence
                          (\\x1b\\\\)                    # ESC \\
                          |                           # alternate
                          (\\x07)                      # BEL (what xterm did)
                        )
                        |                           # alternate (second attempt)
                        (                           # illegal sequence
                          [\\x00-\\x06]                 # anything illegal
                          |                           # alternate
                          [\\x08-\\x1a]                 # anything illegal
                          |                           # alternate
                          [\\x1c-\\x1f]                 # anything illegal
                        )
                    `])))),this._osc_st.lastIndex=0;{let d=this._osc_st.exec(this._buffer);if(d===null)return e.kind=o.Incomplete,e;if(d[3])return e.kind=o.ESC,e.text=this._buffer.slice(0,1),this._buffer=this._buffer.slice(1),e}{let d=this._osc_st.exec(this._buffer);if(d===null)return e.kind=o.Incomplete,e;if(d[3])return e.kind=o.ESC,e.text=this._buffer.slice(0,1),this._buffer=this._buffer.slice(1),e}this._osc_regex||(this._osc_regex=U(R||(R=E([`
                        ^                           # beginning of line
                                                    #
                        \x1B]8;                    # OSC Hyperlink
                        [ -:<-~]*       # params (excluding ;)
                        ;                           # end of params
                        ([!-~]{0,512})        # URL capture
                        (?:                         # ST
                          (?:\x1B\\)                  # ESC                           |                           # alternate
                          (?:\x07)                    # BEL (what xterm did)
                        )
                        ([ -~]+)              # TEXT capture
                        \x1B]8;;                   # OSC Hyperlink End
                        (?:                         # ST
                          (?:\x1B\\)                  # ESC                           |                           # alternate
                          (?:\x07)                    # BEL (what xterm did)
                        )
                    `],[`
                        ^                           # beginning of line
                                                    #
                        \\x1b\\]8;                    # OSC Hyperlink
                        [\\x20-\\x3a\\x3c-\\x7e]*       # params (excluding ;)
                        ;                           # end of params
                        ([\\x21-\\x7e]{0,512})        # URL capture
                        (?:                         # ST
                          (?:\\x1b\\\\)                  # ESC \\
                          |                           # alternate
                          (?:\\x07)                    # BEL (what xterm did)
                        )
                        ([\\x20-\\x7e]+)              # TEXT capture
                        \\x1b\\]8;;                   # OSC Hyperlink End
                        (?:                         # ST
                          (?:\\x1b\\\\)                  # ESC \\
                          |                           # alternate
                          (?:\\x07)                    # BEL (what xterm did)
                        )
                    `]))));let i=this._buffer.match(this._osc_regex);if(i===null)return e.kind=o.ESC,e.text=this._buffer.slice(0,1),this._buffer=this._buffer.slice(1),e;e.kind=o.OSCURL,e.url=i[1],e.text=i[2];var u=i[0].length;return this._buffer=this._buffer.slice(u),e}else if(t=="(")return e.kind=o.Unknown,this._buffer=this._buffer.slice(3),e}}ansi_to_html(e){this.append_buffer(e);for(var n=[];;){var l=this.get_next_packet();if(l.kind==o.EOS||l.kind==o.Incomplete)break;l.kind==o.ESC||l.kind==o.Unknown||(l.kind==o.Text?n.push(this.transform_to_html(this.with_state(l))):l.kind==o.SGR?this.process_ansi(l):l.kind==o.OSCURL&&n.push(this.process_hyperlink(l)))}return n.join("")}with_state(e){return{bold:this.bold,faint:this.faint,italic:this.italic,underline:this.underline,fg:this.fg,bg:this.bg,text:e.text}}process_ansi(e){let n=e.text.split(";");for(;n.length>0;){let l=n.shift(),t=parseInt(l,10);if(isNaN(t)||t===0)this.fg=null,this.bg=null,this.bold=!1,this.faint=!1,this.italic=!1,this.underline=!1;else if(t===1)this.bold=!0;else if(t===2)this.faint=!0;else if(t===3)this.italic=!0;else if(t===4)this.underline=!0;else if(t===21)this.bold=!1;else if(t===22)this.faint=!1,this.bold=!1;else if(t===23)this.italic=!1;else if(t===24)this.underline=!1;else if(t===39)this.fg=null;else if(t===49)this.bg=null;else if(t>=30&&t<38)this.fg=this.ansi_colors[0][t-30];else if(t>=40&&t<48)this.bg=this.ansi_colors[0][t-40];else if(t>=90&&t<98)this.fg=this.ansi_colors[1][t-90];else if(t>=100&&t<108)this.bg=this.ansi_colors[1][t-100];else if((t===38||t===48)&&n.length>0){let u=t===38,i=n.shift();if(i==="5"&&n.length>0){let h=parseInt(n.shift(),10);h>=0&&h<=255&&(u?this.fg=this.palette_256[h]:this.bg=this.palette_256[h])}if(i==="2"&&n.length>2){let h=parseInt(n.shift(),10),d=parseInt(n.shift(),10),p=parseInt(n.shift(),10);if(h>=0&&h<=255&&d>=0&&d<=255&&p>=0&&p<=255){let y={rgb:[h,d,p],class_name:"truecolor"};u?this.fg=y:this.bg=y}}}}}transform_to_html(e){let n=e.text;if(n.length===0||(n=this.escape_txt_for_html(n),!e.bold&&!e.italic&&!e.faint&&!e.underline&&e.fg===null&&e.bg===null))return n;let l=[],t=[],u=e.fg,i=e.bg;e.bold&&l.push(this._boldStyle),e.faint&&l.push(this._faintStyle),e.italic&&l.push(this._italicStyle),e.underline&&l.push(this._underlineStyle),this._use_classes?(u&&(u.class_name!=="truecolor"?t.push(`${u.class_name}-fg`):l.push(`color:rgb(${u.rgb.join(",")})`)),i&&(i.class_name!=="truecolor"?t.push(`${i.class_name}-bg`):l.push(`background-color:rgb(${i.rgb.join(",")})`))):(u&&l.push(`color:rgb(${u.rgb.join(",")})`),i&&l.push(`background-color:rgb(${i.rgb})`));let h="",d="";return t.length&&(h=` class="${t.join(" ")}"`),l.length&&(d=` style="${l.join(";")}"`),`<span${d}${h}>${n}</span>`}process_hyperlink(e){let n=e.url.split(":");return n.length<1||!this._url_allowlist[n[0]]?"":`<a href="${this.escape_txt_for_html(e.url)}">${this.escape_txt_for_html(e.text)}</a>`}}function U(c,...e){let n=c.raw[0],l=/^\s+|\s+\n|\s*#[\s\S]*?\n|\n/gm,t=n.replace(l,"");return new RegExp(t)}function be(c,...e){let n=c.raw[0],l=/^\s+|\s+\n|\s*#[\s\S]*?\n|\n/gm,t=n.replace(l,"");return new RegExp(t,"g")}var D,M,R;const me={class:"dashboard"},pe={class:"top-section"},ve={class:"card system-info"},ye={class:"info-grid"},Se={class:"info-item"},xe={class:"info-value"},we={class:"info-item"},Ce={class:"info-value"},ke={class:"info-item"},Ee={class:"info-value"},Ie={class:"info-item"},Oe={class:"info-value"},Te={class:"card server-control"},Le={class:"card-header"},Be={class:"control-buttons"},Ue=["disabled"],De=["disabled"],Me=["disabled"],Re={class:"middle-section"},$e={class:"card"},je={class:"card-header"},qe={class:"action-buttons"},Fe=["disabled"],Ae=["disabled"],Ge=["disabled"],He={class:"card"},Ne={class:"card-header"},Je={class:"action-buttons"},Ve=["disabled"],Xe=["disabled"],We=["disabled"],ze={class:"card log-section"},Qe={class:"card-header"},Ye={class:"log-controls"},Ze=["title"],Pe=["innerHTML"],Ke={key:0,class:"log-empty"},k="arsm_logs",I=1e3,et=oe({__name:"Dashboard",setup(c){const e=new ge,n=a=>e.ansi_to_html(a),l=m({}),t=m({installed:!1,running:!1}),u=m({installed:!1}),i=m([]),h=m(!0),d=()=>{try{const a=localStorage.getItem(k);a&&(i.value=JSON.parse(a))}catch(a){console.error("åŠ è½½æ—¥å¿—å¤±è´¥:",a)}},p=()=>{try{localStorage.setItem(k,JSON.stringify(i.value))}catch(a){a instanceof Error&&a.name==="QuotaExceededError"&&(i.value=i.value.slice(-Math.floor(I/2)),localStorage.setItem(k,JSON.stringify(i.value)))}},y=a=>{i.value.push(a),i.value.length>I&&(i.value=i.value.slice(-I)),requestAnimationFrame(p)},r=m(!1),g=m();let v=null;const O=a=>a?(a/(1024*1024*1024)).toFixed(1)+" GB":"--",T=async()=>{try{l.value=await Y()}catch(a){console.error(a)}},S=async()=>{try{u.value=await Z()}catch(a){console.error(a)}},b=async()=>{try{t.value=await P()}catch(a){console.error(a)}},$=async()=>{r.value=!0;try{await K(),await b()}catch(a){alert(a.message)}finally{r.value=!1}},j=async()=>{r.value=!0;try{await ee(),await b()}catch(a){alert(a.message)}finally{r.value=!1}},q=async()=>{r.value=!0;try{await te(),await b()}catch(a){alert(a.message)}finally{r.value=!1}},F=async()=>{r.value=!0;try{await se(),await S()}catch(a){alert(a.message)}finally{r.value=!1}},A=async()=>{r.value=!0;try{await le()}catch(a){alert(a.message)}finally{r.value=!1}},G=async()=>{if(confirm("ç¡®å®šè¦åˆ é™¤ SteamCMD å—ï¼Ÿ")){r.value=!0;try{await ne(),await S()}catch(a){alert(a.message)}finally{r.value=!1}}},H=async()=>{r.value=!0;try{await ae(),await b()}catch(a){alert(a.message)}finally{r.value=!1}},N=async()=>{r.value=!0;try{await ie()}catch(a){alert(a.message)}finally{r.value=!1}},J=async()=>{if(confirm("ç¡®å®šè¦åˆ é™¤æ¸¸æˆæœåŠ¡ç«¯å—ï¼Ÿ")){r.value=!0;try{await re(),await b()}catch(a){alert(a.message)}finally{r.value=!1}}},V=()=>{confirm("ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰æ—¥å¿—å—ï¼Ÿ")&&(i.value=[],localStorage.removeItem(k))},X=()=>{h.value=!h.value},W=()=>{B(()=>{g.value&&(g.value.scrollTop=g.value.scrollHeight)})},L=()=>{const a=window.location.protocol==="https:"?"wss:":"ws:";v=new WebSocket(`${a}//${window.location.host}/ws/logs`),v.onmessage=f=>{y(f.data),h.value&&B(()=>{g.value&&(g.value.scrollTop=g.value.scrollHeight)})},v.onclose=()=>{setTimeout(L,3e3)}};return ce(()=>{d(),T(),S(),b(),L();const a=setInterval(T,1e3);ue(()=>{clearInterval(a),v&&v.close()})}),(a,f)=>(C(),x("div",me,[s("div",pe,[s("div",ve,[f[4]||(f[4]=s("div",{class:"card-header"},[s("h3",{class:"card-title"},"ðŸ“Š ç³»ç»Ÿä¿¡æ¯")],-1)),s("div",ye,[s("div",Se,[f[0]||(f[0]=s("span",{class:"info-label"},"æ“ä½œç³»ç»Ÿ",-1)),s("span",xe,_(l.value.os)+" "+_(l.value.arch),1)]),s("div",we,[f[1]||(f[1]=s("span",{class:"info-label"},"ä¸»æœºå",-1)),s("span",Ce,_(l.value.hostname),1)]),s("div",ke,[f[2]||(f[2]=s("span",{class:"info-label"},"CPU ä½¿ç”¨çŽ‡",-1)),s("span",Ee,_(l.value.cpu_usage?.toFixed(1)||"--")+"%",1)]),s("div",Ie,[f[3]||(f[3]=s("span",{class:"info-label"},"å†…å­˜ä½¿ç”¨",-1)),s("span",Oe,_(O(l.value.memory_used))+" / "+_(O(l.value.memory_total)),1)])])]),s("div",Te,[s("div",Le,[f[5]||(f[5]=s("h3",{class:"card-title"},"ðŸŽ® æœåŠ¡ç«¯æŽ§åˆ¶",-1)),s("span",{class:w(["status-badge",t.value.running?"running":"stopped"])},_(t.value.running?"è¿è¡Œä¸­":"å·²åœæ­¢"),3)]),s("div",Be,[s("button",{class:"btn-success",onClick:$,disabled:t.value.running||r.value}," â–¶ å¯åŠ¨ ",8,Ue),s("button",{class:"btn-danger",onClick:j,disabled:!t.value.running||r.value}," â¹ åœæ­¢ ",8,De),s("button",{class:"btn-primary",onClick:q,disabled:!t.value.running||r.value}," ðŸ”„ é‡å¯ ",8,Me)])])]),s("div",Re,[s("div",$e,[s("div",je,[f[6]||(f[6]=s("h3",{class:"card-title"},"ðŸ”§ SteamCMD",-1)),s("span",{class:w(["status-dot",u.value.installed?"status-online":"status-offline"])},null,2)]),s("div",qe,[s("button",{class:"btn-secondary",onClick:S},"ðŸ” æ£€æµ‹"),s("button",{class:"btn-primary",onClick:F,disabled:u.value.installed||r.value}," ðŸ“¥ ä¸‹è½½ ",8,Fe),s("button",{class:"btn-secondary",onClick:A,disabled:!u.value.installed||r.value}," ðŸ”„ æ›´æ–° ",8,Ae),s("button",{class:"btn-danger",onClick:G,disabled:!u.value.installed||r.value}," ðŸ—‘ åˆ é™¤ ",8,Ge)])]),s("div",He,[s("div",Ne,[f[7]||(f[7]=s("h3",{class:"card-title"},"ðŸŽ¯ æ¸¸æˆæœåŠ¡ç«¯",-1)),s("span",{class:w(["status-dot",t.value.installed?"status-online":"status-offline"])},null,2)]),s("div",Je,[s("button",{class:"btn-secondary",onClick:b},"ðŸ” æ£€æµ‹"),s("button",{class:"btn-primary",onClick:H,disabled:t.value.installed||r.value}," ðŸ“¥ ä¸‹è½½ ",8,Ve),s("button",{class:"btn-secondary",onClick:N,disabled:!t.value.installed||r.value}," ðŸ”„ æ›´æ–° ",8,Xe),s("button",{class:"btn-danger",onClick:J,disabled:!t.value.installed||r.value}," ðŸ—‘ åˆ é™¤ ",8,We)])])]),s("div",ze,[s("div",Qe,[f[8]||(f[8]=s("h3",{class:"card-title"},"ðŸ“‹ å®žæ—¶æ—¥å¿—",-1)),s("div",Ye,[s("button",{class:w(["btn-icon",h.value?"btn-active":"btn-secondary"]),onClick:X,title:h.value?"è‡ªåŠ¨æ»šåŠ¨å¼€å¯":"è‡ªåŠ¨æ»šåŠ¨å…³é—­"},_(h.value?"ðŸ“œâ¬‡ï¸":"ðŸ“œ"),11,Ze),s("button",{class:"btn-secondary",onClick:V,title:"æ¸…é™¤æ—¥å¿—"},"ðŸ—‘ï¸"),s("button",{class:"btn-secondary",onClick:W,title:"æ»šåŠ¨åˆ°æœ€æ–°"},"â¬‡ï¸åˆ°åº•")])]),s("div",{class:"log-container",ref_key:"logContainer",ref:g},[(C(!0),x(fe,null,he(i.value,(z,Q)=>(C(),x("div",{key:Q,class:"log-line",innerHTML:n(z)},null,8,Pe))),128)),i.value.length===0?(C(),x("div",Ke," æš‚æ— æ—¥å¿— ")):de("",!0)],512)])]))}}),lt=_e(et,[["__scopeId","data-v-63b39c79"]]);export{lt as default};
